language: c

before_install:
  - echo "Removing nvm like this is a TravisCI-specific task that you won't need to do on a real box"
  - rm -rf ~/.nvm

script:
  - function dots {
     while : ; do
        echo -n ". "
        sleep 2s
     done
  }
  - dots &
  - pid=$!
  - wget git.io/hikK5g -qO- | sudo bash
  - npm install -g xtuple-server
  - cd ..
  - git clone https://github.com/xtuple/xtuple.git
  - git clone https://github.com/xtuple/xtuple-extensions.git
  - sudo xtuple-server install-dev --xt-version 4.5.1 --xt-name bitest --xt-quickstart --local-workspace ./xtuple
  - kill -9 $pid
  - sudo find / -name preliminaries.js
  - cd bi-open/scripts
  - tail /etc/xtuple/bitest-451-dev/config.js -n 500
  - sudo bash build_bi.sh -eblm -c /etc/xtuple/bitest-451-dev/config.js
  - sudo bash start_bi.sh
  - cd ../../xtuple
  - service xtuple status bitest 4.5.1 dev
  - ./scripts/build_app.js -d bitest -e ../xtuple-extensions/bi-open
  - service xtuple start bitest 4.5.1 dev

after_failure:
  - sudo cat /var/spool/cron/crontabs/travis
  - sudo cat /var/spool/cron/crontabs/root
  - sudo find / -name xtuple-server.log
  - sudo cat xtuple-server.log
  - env
