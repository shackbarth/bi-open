
   <Cube name="CRQuote" cache="true" enabled="true" caption="&CRQuote;" defaultMeasure="Amount, Quote Gross">

	&crm-quote-facts-relation;

	<!--  No Company in xTuple
    <DimensionUsage source="Company" name="Company" caption="&Company;"  foreignKey="COMPANY_K" highCardinality="false">
    </DimensionUsage>
	-->
	<!--  No Sales Organizations in xTuple
    <DimensionUsage source="Division" name="Division" caption="&Division;" foreignKey="DIVISION_K" highCardinality="false">
    </DimensionUsage>
    <DimensionUsage source="Business Unit" name="Business Unit" caption="&BusinessUnit;"  foreignKey="BUSINESS_UNIT_K" highCardinality="false">
    </DimensionUsage>
	-->
    <DimensionUsage source="Customer" name="Customer" caption="&Customer;"  foreignKey="CUSTOMER_K" highCardinality="false">
    </DimensionUsage>
	<!--  No Profit Center in xTuple Sales
    <DimensionUsage source="Profit Center" name="Profit Center" caption="&ProfitCenter;" foreignKey="PROFIT_CENTER_K" highCardinality="false">
    </DimensionUsage>
	-->
    <DimensionUsage source="Account Rep" name="Account Rep" caption="&AccountRep;"  foreignKey="ACCOUNT_REP_K" highCardinality="false">
    </DimensionUsage>
    <DimensionUsage source="Product" caption="&Product;" name="Product" foreignKey="ITEM_K">
    </DimensionUsage>
	
    <Dimension type="StandardDimension" highCardinality="false" name="Quote" caption="&Quote;">
    <Hierarchy hasAll="true" allMemberCaption="&QuoteKeyAll;" allMemberName="All Quotes" caption ="&QuoteByKey;">
      <Level name="Quote"  caption="&QuoteKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
	  	<Property name="Quote Name" caption="&QuoteName;" column="ID_DOCUMENT_NAME" >
        </Property>
      </Level>
      <Level name="Quote Line Item" caption="&QuoteLineKey;" column="LINE_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
    </Hierarchy>
    <Hierarchy name="Quote by Status" allMemberCaption="&QuoteStatus;" hasAll="true" allMemberName="All Quotes by Status" caption="&QuoteByStatus;">
      <Level name="Quote Status"  caption="&QuoteStatus;" column="STATUS" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Quote"  caption="&QuoteKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Quote Line Item" caption="&QuoteLineKey;" column="LINE_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
    </Hierarchy>
	</Dimension>
  
	<DimensionUsage source="Issue Date" name="Issue Date" caption="&DateQuote;" foreignKey="ISSUE_DATE_K" highCardinality="false" >
    </DimensionUsage>
	
	<DimensionUsage source="Promise Date" name="Promise Date" caption="&DatePromise;" foreignKey="PROMISE_DATE_K" highCardinality="false" >
    </DimensionUsage>
	
    <Dimension type="TimeDimension" foreignKey="EXPIRE_DATE_K" highCardinality="false" name="Expire Date" caption="&DateExpire;" >
      <Hierarchy name="Calendar" hasAll="true" allMemberName="All Years" allMemberCaption="&DatesAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarPeriod;">
		&expire-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Period" column="PERIOD" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DatePeriod;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["EXPIRE_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
	  <Hierarchy name="Calendar Months" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarMonth;">
		&expire-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Month" column="MONTH" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DateMonth;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["EXPIRE_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
      <Hierarchy name="Calendar Weeks" hasAll="true" allMemberName="All Years" allMemberCaption="&DatesAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarWeek;">
		&expire-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Week" column="WEEK" type="Numeric" uniqueMembers="false" levelType="TimeWeeks" hideMemberIf="Never" caption="&DateWeek;">
          <Property name="Week" column="WEEK" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["EXPIRE_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
    </Dimension>

  <Dimension name="Bill City" caption="&CityBill;" foreignKey="BILL_CITY_K" highCardinality="false" >
    <Hierarchy hasAll="true" allMemberCaption="&CityBillAll;" allMemberName="All Bill Cities" primaryKey="GEO_DATA_K" caption="&CityBillByRegionByCountry;">
		&bill-city-relation;
      <Level name="Country Name" caption="&CityCountryName;" column="COUNTRY_NAME" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
		<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">country</Annotation>
		</Annotations>
      </Level>
      <Level name="Region Code" caption="&CityRegionCode;" column="REGION_CODE_ISO" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
		<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">state</Annotation>
		</Annotations>
        <Property name="Region Name" caption="&RegionName;" column="REGION_CODE" type="String">
        </Property>
      </Level>
      <Level name="City Name" caption="&CityName;" column="CITY_ACCENT_NAME" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
        <Property name="Longitude" caption="&CityLogitude;" column="LONGITUDE" type="Numeric">
        </Property>
        <Property name="Latitude" caption="&CityLatitude;" column="LATITUDE" type="Numeric">
        </Property>
        <Property name="Name" caption="&CityName;" column="CITY_NAME" >
        </Property>
        <Property name="Region" caption="&CityRegionCode;" column="REGION_CODE_ISO" >
        </Property>
  	<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">city</Annotation>
  	</Annotations>
      </Level>
    </Hierarchy>
    <Hierarchy name="Bill Region" hasAll="true" allMemberCaption="&RegionBillAll;" allMemberName="All Bill Regions" primaryKey="GEO_DATA_K" caption="&RegionBill;">
		&bill-city-relation;
      <Level name="Region Code" caption="&CityRegionCode;" column="REGION_CODE" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
        <Property name="Region Name" caption="&RegionName;" column="REGION_CODE" type="String">
        </Property>
  	<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">state</Annotation>
  	</Annotations> 
      </Level>
    </Hierarchy>
  </Dimension>

  <Dimension name="Ship City" caption="&CityShip;" foreignKey="SHIP_CITY_K" highCardinality="false" >
    <Hierarchy hasAll="true" allMemberCaption="&CityShipAll;" allMemberName="All Ship Cities" primaryKey="GEO_DATA_K" caption="&CityShipByRegionByCountry;">
		&ship-city-relation;
      <Level name="Country Name" caption="&CityCountryName;" column="COUNTRY_NAME" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
  	<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">country</Annotation>
  	</Annotations>
      </Level>
      <Level name="Region Code" caption="&CityRegionCode;" column="REGION_CODE_ISO" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
		<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">state</Annotation>
		</Annotations>
		<Property name="Region Name" caption="&RegionName;" column="REGION_CODE" type="String">
        </Property>
      </Level>
      <Level name="City Name" caption="&CityName;" column="CITY_ACCENT_NAME" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
        <Property name="Longitude" caption="&CityLogitude;" column="LONGITUDE" type="Numeric">
        </Property>
        <Property name="Latitude" caption="&CityLatitude;" column="LATITUDE" type="Numeric">
        </Property>
        <Property name="Name" caption="&CityName;" column="CITY_NAME" >
        </Property>
        <Property name="Region" caption="&CityRegionCode;" column="REGION_CODE_ISO" >
        </Property>
  	<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">city</Annotation>
  	</Annotations>
      </Level>
    </Hierarchy>
    <Hierarchy name="Ship Region" hasAll="true" allMemberCaption="&RegionShipAll;" allMemberName="All Ship Regions" primaryKey="GEO_DATA_K" caption="&RegionShip;">
		&ship-city-relation;
      <Level name="Region Code" caption="&CityRegionCode;" column="REGION_CODE" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
        <Property name="Region Name" caption="&RegionName;" column="REGION_CODE" type="String">
        </Property>
  	<Annotations>
    		<Annotation name="Data.Role">Geography</Annotation>
    		<Annotation name="Geo.Role">state</Annotation>
  	</Annotations> 
     </Level>
    </Hierarchy>
  </Dimension>

    <Measure name="Amount, Quote Gross" caption="&QuoteAmount;" column="AMOUNT" formatString="&FormatCurrency;" aggregator="sum">
    </Measure>
    <Measure name="Amount, Quote Gross List" caption="&QuoteAmountList;" column="AMOUNT_LIST" formatString="&FormatCurrency;" aggregator="sum">
    </Measure>
    <Measure name="Amount, Quote Quantity" caption="&QuoteAmountQuantity;" column="QUANTITY_ORDER" formatString="&FormatCount;" aggregator="sum">
    </Measure>
    <Measure name="Count, Quotes" caption="&QuoteCount;"  column="ID_DOCUMENT_NK" formatString="&FormatCount;" aggregator="distinct-count">
    </Measure>
    <Measure name="Days Quote Date"  column="ISSUE_DATE_K" formatString="########" aggregator="min" visible="false">
    </Measure>
    <Measure name="Days Promise Date" column="PROMISE_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>
	<Measure name="Days Expire Date" column="EXPIRE_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>

    <CalculatedMember name="Amount, Quote Discount" caption="&QuoteDiscount;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
                [Measures].[Amount, Quote Gross List] - [Measures].[Amount, Quote Gross] ]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCurrency;"/>
    </CalculatedMember>

    <CalculatedMember name="Average, Quote Gross" caption="&QuoteAverage;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
                iif([Measures].[Count, Quotes] = 0, 0, [Measures].[Amount, Quote Gross]/[Measures].[Count, Quotes])]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCurrency;"/>
    </CalculatedMember>

<!--
        For dates if we have not date or we are not at the Quote level, return null
-->
    <CalculatedMember name="Date, Quote" caption="&QuoteDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Quote].CurrentMember.level.ordinal <> 1 AND [Quote].level.ordinal <> 2 AND [Quote.Quote by Status].level.ordinal <> 2 AND [Quote.Quote by Status].level.ordinal <> 3 , "",
              iif([Measures].[Days Quote Date] is empty,  cast (null as string),
                iif([Measures].[Days Quote Date] = 0, "",
                getDateString(cast([Measures].[Days Quote Date] as string)))))]]>
      </Formula>
    </CalculatedMember>
    <CalculatedMember name="Date, Promise" caption="&QuotePromise;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Quote].CurrentMember.level.ordinal <> 1 AND [Quote].level.ordinal <> 2 AND [Quote.Quote by Status].level.ordinal <> 2 AND [Quote.Quote by Status].level.ordinal <> 3 , "",
              iif([Measures].[Days Promise Date] is empty, cast (null as string),
                iif([Measures].[Days Promise Date] = 0, "",
                getDateString(cast([Measures].[Days Promise Date] as string)))))]]>
      </Formula>
    </CalculatedMember>
    <CalculatedMember name="Date, Expire" caption="&QuoteExpire;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Quote].CurrentMember.level.ordinal <> 1 AND [Quote].level.ordinal <> 2 AND [Quote.Quote by Status].level.ordinal <> 2 AND [Quote.Quote by Status].level.ordinal <> 3 , "",
              iif([Measures].[Days Expire Date] is empty OR [Measures].[Days Expire Date] = -1 , cast (null as string),
                iif([Measures].[Days Expire Date] = 0, "",
                getDateString(cast([Measures].[Days Expire Date] as string)))))]]>
      </Formula>
    </CalculatedMember>
	
    <CalculatedMember name="Days, Now to Expiration" caption="&DaysNowToExpiration;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			iif([Measures].[Days Expire Date] = -1,
			  cast(null as numeric),
			  [Measures].[Days Expire Date] - cast(getCurrentDays("today") as numeric)
			)
		]]>
      </Formula>
    </CalculatedMember>

  </Cube>
  
  <Cube name="CROpportunity" cache="true" enabled="true" caption="&CROpportunity;" defaultMeasure="Amount, Opportunity Gross">

	&crm-opportunity-facts-relation;

	<!--  No Company in xTuple
    <DimensionUsage source="Company" name="Company" caption="&Company;"  foreignKey="COMPANY_K" highCardinality="false">
    </DimensionUsage>
	-->
	<!--  No Sales Organizations in xTuple
    <DimensionUsage source="Division" name="Division" caption="&Division;" foreignKey="DIVISION_K" highCardinality="false">
    </DimensionUsage>
    <DimensionUsage source="Business Unit" name="Business Unit" caption="&BusinessUnit;"  foreignKey="BUSINESS_UNIT_K" highCardinality="false">
    </DimensionUsage>
	-->
    <DimensionUsage source="CRM Account" name="CRM Account" caption="&CrmAccount;"  foreignKey="CRM_ACCOUNT_K" highCardinality="false">
    </DimensionUsage>
	<!--  No Profit Center in xTuple Sales
    <DimensionUsage source="Profit Center" name="Profit Center" caption="&ProfitCenter;" foreignKey="PROFIT_CENTER_K" highCardinality="false">
    </DimensionUsage>
	-->
    <DimensionUsage source="User" name="User" caption="&UserAssigned;"  foreignKey="USER_K" highCardinality="false">
    </DimensionUsage>
	
    <Dimension type="StandardDimension" highCardinality="false" name="Opportunity" caption="&Opportunity;">	
    <Hierarchy hasAll="true" allMemberCaption="&OpportunityAll;" allMemberName="All Opportunities" caption ="&Opportunity;">	
	  <Level name="Opportunity"  caption="&OpportunityKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
	  	<Property name="Opportunity Name" caption="&OpportunityName;" column="ID_DOCUMENT_NAME" >
        </Property>
      </Level>	
    </Hierarchy>
    <Hierarchy name="Opportunity by Status by Type" hasAll="true" allMemberCaption="&OpportunityStatusTypeAll;" allMemberName="All Opportunities" primaryKey="Opportunity_K" caption ="&OpportunityByStatusType;">
      <Level name="Opportunity Status"  caption="&OpportunityStatus;" column="STATUS" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Opportunity Type"  caption="&OpportunityType;" column="TYPE" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
	  <Level name="Opportunity"  caption="&OpportunityKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
    </Hierarchy>
    <Hierarchy name="Opportunity by Status by Stage" allMemberCaption="&OpportunityStatusStageAll;" hasAll="true" allMemberName="All Opportunities by Status" caption="&OpportunityByStatusStage;">
      <Level name="Opportunity Status"  caption="&OpportunityStatus;" column="STATUS" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Opportunity Stage" caption="&OpportunityStage;" column="STAGE" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Opportunity"  caption="&OpportunityKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>	  
    </Hierarchy>
	</Dimension>
	
	<DimensionUsage source="Issue Date" name="Issue Date" caption="&DateOpportunity;" foreignKey="ISSUE_DATE_K" highCardinality="false" >
    </DimensionUsage>
  
	<Dimension type="TimeDimension" foreignKey="ASSIGN_DATE_K" highCardinality="false" name="Assigned Date" caption="&DateAssigned;">
      <Hierarchy name="Calendar" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarPeriod;">
		&assigned-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Period" column="PERIOD" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DatePeriod;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["ASSIGNED_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
	  <Hierarchy name="Calendar Months" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarMonth;">
		&assigned-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Month" column="MONTH" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DateMonth;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["ASSIGNED_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
      <Hierarchy name="Calendar Weeks" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarWeek;">
		&assigned-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Week" column="WEEK" type="Numeric" uniqueMembers="false" levelType="TimeWeeks" hideMemberIf="Never" caption="&DateWeek;">
          <Property name="Week" column="WEEK" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["ASSIGNED_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
    </Dimension>
	
	<Dimension type="TimeDimension" foreignKey="TARGET_DATE_K" highCardinality="false" name="Target Date" caption="&DateTarget;">
      <Hierarchy name="Calendar" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarPeriod;">
		&target-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Period" column="PERIOD" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DatePeriod;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["TARGET_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
	  <Hierarchy name="Calendar Months" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarMonth;">
		&target-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Month" column="MONTH" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DateMonth;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["TARGET_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
      <Hierarchy name="Calendar Weeks" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarWeek;">
		&target-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Week" column="WEEK" type="Numeric" uniqueMembers="false" levelType="TimeWeeks" hideMemberIf="Never" caption="&DateWeek;">
          <Property name="Week" column="WEEK" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["TARGET_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
    </Dimension>

	<Dimension type="TimeDimension" foreignKey="ACTUAL_DATE_K" highCardinality="false" name="Actual Date" caption="&DateActual;">
      <Hierarchy name="Calendar" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarPeriod;">
		&actual-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Period" column="PERIOD" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DatePeriod;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["ACTUAL_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
	  <Hierarchy name="Calendar Months" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarMonth;">
		&actual-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Month" column="MONTH" type="Numeric" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never" caption="&DateMonth;">
          <Property name="Month" column="PERIOD" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["ACTUAL_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
      <Hierarchy name="Calendar Weeks" hasAll="true" allMemberName="All Years" allMemberCaption="&DateAllYears;" primaryKey="DAYS_DATE" caption="&DateCalendarWeek;">
		&actual-date-relation;
        <Level name="Year" column="YEAR" type="Numeric" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never" caption="&DateYear;">
        </Level>
        <Level name="Week" column="WEEK" type="Numeric" uniqueMembers="false" levelType="TimeWeeks" hideMemberIf="Never" caption="&DateWeek;">
          <Property name="Week" column="WEEK" type="Numeric">
          </Property>
        </Level>
        <Level name="Date" type="Date" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never" caption="&Date;">
          <KeyExpression>
            <SQL dialect="mssql">
              <![CDATA[SUBSTRING(CONVERT(CHAR, "THE_DATE", 120), 1, 10)]]>
            </SQL>
            <SQL dialect="generic">
              <![CDATA["ACTUAL_DATE"."THE_DATE"]]>
            </SQL>
          </KeyExpression>
          <Property name="Date" column="THE_DATE" type="String">
          </Property>
          <Property name="Days Date" column="DAYS_DATE" type="Numeric">
          </Property>
        </Level>
      </Hierarchy>
    </Dimension>
	
	  <Dimension name="Contact City" caption="&CityContact;" foreignKey="CONTACT_CITY_K" highCardinality="false" >
		<Hierarchy hasAll="true" allMemberCaption="&CityContactAll;" allMemberName="All Contact Cities" primaryKey="GEO_DATA_K" caption="&CityContactByRegionByCountry;">
			&contact-city-relation;
		  <Level name="Country Name" caption="&CityCountryName;" column="COUNTRY_NAME" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
			<Annotations>
				<Annotation name="Data.Role">Geography</Annotation>
				<Annotation name="Geo.Role">country</Annotation>
			</Annotations>
		  </Level>
		  <Level name="Region Code" caption="&CityRegionCode;" column="REGION_CODE_ISO" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
			<Annotations>
				<Annotation name="Data.Role">Geography</Annotation>
				<Annotation name="Geo.Role">state</Annotation>
			</Annotations>
			<Property name="Region Name" caption="&RegionName;" column="REGION_CODE" type="String">
			</Property>
		  </Level>
		  <Level name="City Name" caption="&CityName;" column="CITY_ACCENT_NAME" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
			<Property name="Longitude" caption="&CityLogitude;" column="LONGITUDE" type="Numeric">
			</Property>
			<Property name="Latitude" caption="&CityLatitude;" column="LATITUDE" type="Numeric">
			</Property>
			<Property name="Name" caption="&CityName;" column="CITY_NAME" >
			</Property>
			<Property name="Region" caption="&CityRegionCode;" column="REGION_CODE_ISO" >
			</Property>
		<Annotations>
				<Annotation name="Data.Role">Geography</Annotation>
				<Annotation name="Geo.Role">city</Annotation>
		</Annotations>
		  </Level>
		</Hierarchy>
		<Hierarchy name="Contact Region" hasAll="true" allMemberCaption="&RegionContactAll;" allMemberName="All Contact Regions" primaryKey="GEO_DATA_K" caption="&RegionContact;">
			&bill-city-relation;
		  <Level name="Region Code" caption="&CityRegionCode;" column="REGION_CODE" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
			<Property name="Region Name" caption="&RegionName;" column="REGION_CODE" type="String">
			</Property>
		<Annotations>
				<Annotation name="Data.Role">Geography</Annotation>
				<Annotation name="Geo.Role">state</Annotation>
		</Annotations> 
		  </Level>
		</Hierarchy>
	  </Dimension>

	
    <Measure name="Amount, Opportunity Gross" caption="&OpportunityAmount;" column="AMOUNT" formatString="&FormatCurrency;" aggregator="sum">
    </Measure>
    <Measure name="Amount, Opportunity Weighted" caption="&OpportunityAmountWeighted;" column="AMOUNT_WEIGHTED" formatString="&FormatCurrency;" aggregator="sum">
    </Measure>	
	<Measure name="Percent, Opportunity Probability" caption="&OpportunityProbabilityPercent;" column="PROBABILITY" formatString="&FormatRatio;" aggregator="avg">
    </Measure>
    <Measure name="Count, Opportunities" caption="&OpportunityCount;"  column="ID_DOCUMENT_NK" formatString="&FormatCount;" aggregator="distinct-count">
    </Measure>
    <Measure name="Days Opportunity Date"  column="ISSUE_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>
    <Measure name="Days Assigned Date" column="ASSIGN_DATE_K" formatString="########" aggregator="sum" visible="false">
    </Measure>
	<Measure name="Days Target Date"  column="TARGET_DATE_K" formatString="########" aggregator="sum" visible="false">
    </Measure>
    <Measure name="Days Actual Date"  column="ACTUAL_DATE_K" formatString="########" aggregator="sum" visible="false">
    </Measure>
	
	<CalculatedMember name="Average, Opportunity Gross" caption="&OpportunityAverage;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
                iif([Measures].[Count, Opportunities] = 0, 0, [Measures].[Amount, Opportunity Gross]/[Measures].[Count, Opportunities])]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCurrency;"/>
    </CalculatedMember>
	
	<CalculatedMember name="Average, Opportunity Weighted" caption="&OpportunityWeightedAverage;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
                iif([Measures].[Count, Opportunities] = 0, 0, [Measures].[Amount, Opportunity Weighted]/[Measures].[Count, Opportunities])]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCurrency;"/>
    </CalculatedMember>
	
<!--
        For dates if we have no date or we are not at the Opportunity level, return null
-->

    <CalculatedMember name="Date, Opportunity" caption="&OpportunityDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Opportunity Date] is empty,  cast (null as string),
                iif([Measures].[Days Opportunity Date] = 0, "",
                getDateString(cast([Measures].[Days Opportunity Date] as string)))))]]>
      </Formula>
    </CalculatedMember>	

    <CalculatedMember name="Date, Assigned" caption="&AssignedDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Assigned Date] is empty,  cast (null as string),
                iif([Measures].[Days Assigned Date] = 0, "",
                getDateString(cast([Measures].[Days Assigned Date] as string)))))]]>
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Date, Target" caption="&TargetDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Target Date] is empty,  cast (null as string),
                iif([Measures].[Days Target Date] = 0, "",
                getDateString(cast([Measures].[Days Target Date] as string)))))]]>
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Date, Actual" caption="&ActualDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Actual Date] is empty,  cast (null as string),
                iif([Measures].[Days Actual Date] = 0, "",
                getDateString(cast([Measures].[Days Actual Date] as string)))))]]>
      </Formula>
    </CalculatedMember>	
	
	<!--
	  Date differences are easiest using the date surrogate key which is the number of days since 1990.  This allows
	  dates to to aggregated and subtracted over dimensions.  This is essential if you have Days differences as
	  calculated meausures (instead of just measures in a query).  In Opportunities we are missing dates, where a missing
	  date is surrogate key 0.  We must have a date so when missing we choose today.  We get the number of days since
	  1990 for today with a Java method getCurrentDays.  This means we must provide our own
	  aggregated calculation substituting today for 0.  This is done by recursively calling the calculation on the
	  Opportunities hierarchy.  Note that we are always positioned somewhere in the hierarchy.  If Opportunities are not
	  on an axis, we are positioned at the "All" member which is the default member (level.ordinal = 0).
	-->	
	
    <CalculatedMember name="S2A" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
			iif([Measures].[Days Assigned Date] = 0, 
			  cast(getCurrentDays("today") as numeric) - [Measures].[Days Opportunity Date],
			  [Measures].[Days Assigned Date] - [Measures].[Days Opportunity Date]
			)
		]]>
      </Formula>
    </CalculatedMember>
	
    <CalculatedMember name="S2A Sum" caption="S2A Sum" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
		    iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 0,
			  sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity Status]), [Measures].[S2A Sum]),
			  iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 1,
			    sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity Stage]), [Measures].[S2A Sum]),  			    
				  iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 2,
			        sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity]), [Measures].[S2A Sum]),  
			        iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 3,
				      [Measures].[S2A], 
				      cast(null as numeric)
					)
				  )				
			  )	
			)
		]]>
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Days, Start to Assigned" caption="&CrmDaysS2A;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			[Measures].[S2A Sum] / [Measures].[Count, Opportunities]
		]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCount;"/>
    </CalculatedMember>	
	
    <CalculatedMember name="S2T" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
			iif([Measures].[Days Target Date] = 0, 
			  cast(getCurrentDays("today") as numeric) - [Measures].[Days Opportunity Date],
			  [Measures].[Days Target Date] - [Measures].[Days Opportunity Date]
			)
		]]>
      </Formula>
    </CalculatedMember>
	
    <CalculatedMember name="S2T Sum" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
		    iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 0,
			  sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity Status]), [Measures].[S2T Sum]),
			  iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 1,
			    sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity Stage]), [Measures].[S2T Sum]),  
				  iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 2,
			        sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity]), [Measures].[S2T Sum]),  
			        iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 3,
				      [Measures].[S2T], 
				      cast(null as numeric)
					)
				  )				
			  )
			)
		]]>
      </Formula>
    </CalculatedMember>	
	
	<CalculatedMember name="Days, Start to Target" caption="&CrmDaysS2T;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			[Measures].[S2T Sum] / [Measures].[Count, Opportunities]
		]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCount;"/>
    </CalculatedMember>
	
    <CalculatedMember name="S2C" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
			iif([Measures].[Days Actual Date] = 0, 
			  cast(getCurrentDays("today") as numeric) - [Measures].[Days Opportunity Date],
			  [Measures].[Days Actual Date] - [Measures].[Days Opportunity Date]
			)
		]]>
      </Formula>
    </CalculatedMember>
	
    <CalculatedMember name="S2C Sum" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
		    iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 0,
			  sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity Status]), [Measures].[S2C Sum]),
			  iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 1,
			    sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity Stage]), [Measures].[S2C Sum]),  
				  iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 2,
			        sum(descendants([Opportunity.Opportunity by Status by Stage].CurrentMember,[Opportunity.Opportunity by Status by Stage].[Opportunity]), [Measures].[S2C Sum]),  
			        iif(1 > 0 and [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal = 3,
				      [Measures].[S2C], 
				      cast(null as numeric)
					)
				  )
			  )
			)
		]]>
      </Formula>
    </CalculatedMember>	
	
    <CalculatedMember name="Days, Start to Actual" caption="&CrmDaysS2C;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			[Measures].[S2C Sum] / [Measures].[Count, Opportunities]
		]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCount;"/>
    </CalculatedMember>
	
  </Cube>
  
  <Cube name="CROpportunityForecast" cache="true" enabled="true" caption="&CROpportunityForecast;" defaultMeasure="Amount, Opportunity Forecast">

	&crm-opportunity-facts-by-period-relation;

	<!--  No Company in xTuple
    <DimensionUsage source="Company" name="Company" caption="&Company;"  foreignKey="COMPANY_K" highCardinality="false">
    </DimensionUsage>
	-->
	<!--  No Sales Organizations in xTuple
    <DimensionUsage source="Division" name="Division" caption="&Division;" foreignKey="DIVISION_K" highCardinality="false">
    </DimensionUsage>
    <DimensionUsage source="Business Unit" name="Business Unit" caption="&BusinessUnit;"  foreignKey="BUSINESS_UNIT_K" highCardinality="false">
    </DimensionUsage>
	-->
    <DimensionUsage source="CRM Account" name="CRM Account" caption="&CrmAccount;"  foreignKey="CRM_ACCOUNT_K" highCardinality="false">
    </DimensionUsage>
	<!--  No Profit Center in xTuple Sales
    <DimensionUsage source="Profit Center" name="Profit Center" caption="&ProfitCenter;" foreignKey="PROFIT_CENTER_K" highCardinality="false">
    </DimensionUsage>
	-->
    <DimensionUsage source="User" name="User" caption="&User;"  foreignKey="USER_K" highCardinality="false">
    </DimensionUsage>

	<Dimension type="StandardDimension" highCardinality="false" name="Opportunity" caption="&Opportunity;">
    <Hierarchy name="Opportunity by Status by Type" hasAll="true" allMemberCaption="&OpportunityStatusTypeAll;" allMemberName="All Opportunities" primaryKey="Opportunity_K" caption ="&OpportunityByStatusType;">
      <Level name="Opportunity Status"  caption="&OpportunityStatus;" column="STATUS" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Opportunity Type"  caption="&OpportunityType;" column="TYPE" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
	  <Level name="Opportunity"  caption="&OpportunityKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
    </Hierarchy>
    <Hierarchy name="Opportunity by Status by Stage" allMemberCaption="&OpportunityStatusStageAll;" hasAll="true" allMemberName="All Opportunities by Status" caption="&OpportunityByStatusStage;">
      <Level name="Opportunity Status"  caption="&OpportunityStatus;" column="STATUS" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Opportunity Stage" caption="&OpportunityStage;" column="STAGE" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>
      <Level name="Opportunity"  caption="&OpportunityKey;" column="ID_TRANS_DOC_NK" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never">
      </Level>	  
    </Hierarchy>
	</Dimension>
	
	<DimensionUsage source="Period" name="Fiscal Period" caption="&Period;" foreignKey="ISSUE_FISCAL_PERIOD_K" highCardinality="false">
    </DimensionUsage>
	
    <Measure name="Opportunity Gross" column="AMOUNT" formatString="&FormatCurrency;" aggregator="sum" visible="false">
    </Measure>
    <Measure name="Opportunity Weighted" column="AMOUNT_WEIGHTED" formatString="&FormatCurrency;" aggregator="sum" visible="false">
    </Measure>	
	<Measure name="Percent, Forecast Probability" caption="&ForecastProbabilityPercent;" column="PROBABILITY" formatString="&FormatCount;" aggregator="avg">
    </Measure>
    <Measure name="Count, Opportunities" caption="&OpportunityCount;"  column="ID_DOCUMENT_NK" formatString="&FormatCount;" aggregator="distinct-count">
    </Measure>
    <Measure name="Days Opportunity Date"  column="ISSUE_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>
    <Measure name="Days End Date" column="ISSUE_PERIOD_ENDDATE_K" formatString="########" aggregator="sum" visible="false">
    </Measure>
    <Measure name="Days Actual Date"  column="ACTUAL_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>
	<Measure name="Days Assigned Date" column="ASSIGN_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>
	<Measure name="Days Target Date"  column="TARGET_DATE_K" formatString="########" aggregator="max" visible="false">
    </Measure>
	
<!--
        For dates if we have no date or we are not at the Opportunity level, return null
-->

    <CalculatedMember name="Date, Opportunity" caption="&OpportunityDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Opportunity Date] is empty,  cast (null as string),
                iif([Measures].[Days Opportunity Date] = 0, "",
					getDateString(cast([Measures].[Days Opportunity Date] as string))
				)
			  )
			)
		]]>
      </Formula>
    </CalculatedMember>
	
    <CalculatedMember name="Date, Assigned" caption="&AssignedDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Assigned Date] is empty,  cast (null as string),
                iif([Measures].[Days Assigned Date] = 0, "",
                getDateString(cast([Measures].[Days Assigned Date] as string))
				)
			  )
			)
		]]>
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Date, Target" caption="&TargetDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Target Date] is empty,  cast (null as string),
                iif([Measures].[Days Target Date] = 0, "",
                getDateString(cast([Measures].[Days Target Date] as string))
				)
			  )
			)
		]]>
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Date, Actual" caption="&ActualDate;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
            iif ([Opportunity.Opportunity by Status by Type].CurrentMember.level.ordinal <> 3 AND [Opportunity.Opportunity by Status by Stage].CurrentMember.level.ordinal <> 3, "",
              iif([Measures].[Days Actual Date] is empty,  cast (null as string),
                iif([Measures].[Days Actual Date] = 0, "",
                getDateString(cast([Measures].[Days Actual Date] as string))
				)
			  )
			)
		]]>
      </Formula>
    </CalculatedMember>	
	
    <CalculatedMember name="S2E" dimension="Measures" visible="false">
      <Formula>
        <![CDATA[
			[Measures].[Days End Date] - [Measures].[Days Opportunity Date]
		]]>
      </Formula>
    </CalculatedMember>
	
    <CalculatedMember name="Days, Start to Actual" caption="&CrmDaysS2C;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			iif(1 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 0,
				sum(tail(descendants([Fiscal Period].CurrentMember,[Fiscal Period].[Fiscal Year])), [Measures].[Days, Start to Actual]),
				iif(1 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 1,
					sum(tail(descendants([Fiscal Period].CurrentMember,[Fiscal Period].[Fiscal Period])), [Measures].[Days, Start to Actual]),
					iif(2 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 2,
						[Measures].[S2E] / [Measures].[Count, Opportunities],
						cast(null as numeric)
					)
				)
			)
		]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCount;"/>
    </CalculatedMember>
	
    <CalculatedMember name="Amount, Opportunity Forecast" caption="&OpportunityForecast;" dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			iif(1 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 0,
				sum(tail(descendants([Fiscal Period].CurrentMember,[Fiscal Period].[Fiscal Year])), [Measures].[Opportunity Gross]),
				iif(1 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 1,
					sum(tail(descendants([Fiscal Period].CurrentMember,[Fiscal Period].[Fiscal Period])), [Measures].[Opportunity Gross]),
					iif(2 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 2,
						[Measures].[Opportunity Gross],
						cast(null as numeric)
					)
				)
			)
		]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCurrency;"/>
    </CalculatedMember>
	
    <CalculatedMember name="Amount, Forecast Weighted" caption="&ForecastWeighted;"  dimension="Measures" visible="true">
      <Formula>
        <![CDATA[
			iif(1 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 0,
				sum(tail(descendants([Fiscal Period].CurrentMember,[Fiscal Period].[Fiscal Year])), [Measures].[Opportunity Weighted]),				
				iif(1 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 1,
					sum(tail(descendants([Fiscal Period].CurrentMember,[Fiscal Period].[Fiscal Period])), [Measures].[Opportunity Weighted]),
					iif(2 > 0 and [Fiscal Period].CurrentMember.level.ordinal = 2,
						[Measures].[Opportunity Weighted],
						cast(null as numeric)
					)
				)
			)
		]]>
      </Formula>
	  <CalculatedMemberProperty name="FORMAT_STRING" value="&FormatCurrency;"/>
    </CalculatedMember>

  </Cube>